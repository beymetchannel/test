name: Event Scraper and Data Commit2

on:
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œãƒˆãƒªã‚¬ãƒ¼

jobs:
  scrape-and-commit:
    runs-on: ubuntu-latest
    
    # ğŸš¨ æ¨©é™è¨­å®š: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«æ›¸ãè¾¼ã‚€ãŸã‚ã«å¿…è¦
    permissions:
      contents: write 

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        # fetch-depth: 0 ã‚’ã¤ã‘ã‚‹ã¨ã€pushã™ã‚‹éš›ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºã«ãããªã‚Šã¾ã™
        with:
          fetch-depth: 0 

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 1. ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å¼·åˆ¶ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆModuleNotFoundErrorã‚’è§£æ¶ˆï¼‰
      - name: Install dependencies (Selenium, Manager)
        run: pip install selenium webdriver-manager
      
      # 2. ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å®Ÿè¡Œ
      - name: Run scraper.py
        # å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åãŒ 'events.json' ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
        run: python scraper.py

      # 3. JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªãƒã‚¸ãƒˆãƒªã¸ã®ä¿å­˜ï¼ˆã‚³ãƒŸãƒƒãƒˆï¼‰
      - name: Commit and Push new events.json
        run: |
          # Gitãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¨­å®š
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # ä½œæˆã•ã‚ŒãŸ JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã«è¿½åŠ 
          git add events.json
          
          # å¤‰æ›´ãŒãªã‘ã‚Œã°ã‚³ãƒŸãƒƒãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ— (ã‚¨ãƒ©ãƒ¼é˜²æ­¢)
          if git diff --cached --exit-code; then
            echo "No changes in events.json detected. Skipping commit."
          else
            # å¤‰æ›´ãŒã‚ã‚Œã°ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
            git commit -m "ğŸ¤– Chore: Update event data (events.json)"
            git push
            echo "New events.json committed and pushed successfully."
          fi
